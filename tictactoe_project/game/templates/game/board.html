{% extends "base.html" %}
{% load custom_tags %}

{% block content %}
<div id="board">
    <table border="1" style="border-collapse: collapse; text-align: center; font-size: 2em;">
      {% for r in 0|to:3 %}
      <tr>
        {% for c in 0|to:3 %}
          <td style="width: 60px; height: 60px;">
            {% if board|get_item:r|get_item:c == 0 %}
              <button hx-get="{% url 'make_move' r c %}" 
                      hx-target="#board"
                      hx-swap="outerHTML"
                      style="width:100%;height:100%;font-size:2em;">
                &nbsp;
              </button>
            {% elif board|get_item:r|get_item:c == 1 %}
              X
            {% elif board|get_item:r|get_item:c == 2 %}
              O
            {% endif %}
          </td>
        {% endfor %}
      </tr>
      {% endfor %}
    </table>
</div>

<!-- Training controls go here -->
<div style="margin-top:20px; text-align:center;">
  <button hx-get="{% url 'start_training' %}"
          hx-target="#training-status"
          hx-swap="innerHTML"
          style="padding:10px 20px; font-size:1.2em;">
    Start Training
  </button>
</div>

<div id="training-status" style="margin-top:10px; text-align:center;">
  <!-- Training status will be updated here -->
</div>
<div id="stats">
  <p id="episode">Episode: 0</p>
  <p id="wins">Wins: 0</p>
  <p id="losses">Losses: 0</p>
  <p id="draws">Draws: 0</p>
  <p id="epsilon">Epsilon: 1.0</p>
  <p id="status">Ready to train....</p>

</div>
<script>
  document.getElementById("start-training").addEventListener("click",()=>{fetch("/train_step")
    .then(res=>res.json())
    .then(data=>{
      document.getElementById("episode").innerText = "Episode: " + data.episode;
      document.getElementById("wins").innerText = "Wins: " + data.wins;
      document.getElementById("losses").innerText = "Losses: " + data.losses;
      document.getElementById("draws").innerText = "Draws: " + data.draws;
      document.getElementById("epsilon").innerText = "Epsilon: " + data.epsilon.toFixed(2);
      document.getElementById("status").innerText = data.status;
      if (data.training_done) {
        
          document.getElementById("play-agent").disbaled=false;}
         // Adjust delay as needed
      
    });
  });
</script>
{% endblock %}
